generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Language {
  code        String   @id @default("en") @db.VarChar(10)
  name        String   @db.VarChar(100)
  nativeName  String   @db.VarChar(100)
  direction   String   @default("ltr") @db.VarChar(3)
  flag        String?  @db.VarChar(5)
  bcp47Locale String   @db.VarChar(10)
  enabled     Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([enabled])
  @@map("languages")
}

model User {
  id                        String                  @id @default(cuid())
  tenantId                  String
  email                     String
  name                      String?
  password                  String?
  image                     String?
  role                      UserRole                @default(CLIENT)
  emailVerified             DateTime?
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt
  sessionVersion            Int                     @default(0)
  employeeId                String?                 @unique
  department                String?
  position                  String?
  skills                    String[]
  expertiseLevel            ExpertiseLevel?
  hourlyRate                Decimal?
  availabilityStatus        AvailabilityStatus      @default(AVAILABLE)
  maxConcurrentProjects     Int?                    @default(3)
  hireDate                  DateTime?
  managerId                 String?
  tier                      String?                 // Client tier: INDIVIDUAL, SMB, ENTERPRISE
  workingHours              Json?                   // Team working hours schedule
  bookingBuffer             Int?                    // Minutes buffer between bookings
  autoAssign                Boolean?                // Auto-assign tasks
  certifications            String[]                // Team certifications
  experienceYears           Int?                    // Years of experience
  attachments               Attachment[]
  bookingPreferences        BookingPreferences?
  assignedByServiceRequests ServiceRequest[]        @relation("ServiceRequestAssignedBy")
  clientServiceRequests     ServiceRequest[]        @relation("ServiceRequestClient")
  tasks                     Task[]
  taskComments              TaskComment[]
  assignedWorkOrders        WorkOrder[]             @relation("WorkOrderAssignee")
  workOrdersAsClient        WorkOrder[]             @relation("WorkOrderClient")
  accounts                  Account[]
  auditEvents               AuditEvent[]
  auditLogs                 AuditLog[]
  bookings                  Booking[]
  rolesCreated              CustomRole[]            @relation("RoleCreatedBy")
  expenses                  Expense[]
  favoriteSettings          FavoriteSetting[]
  invoices                  Invoice[]
  menuCustomization         MenuCustomization?
  permissionAuditsChanged   PermissionAudit[]       @relation("AuditChangedBy")
  permissionAudits          PermissionAudit[]
  templatesCreated          PermissionTemplate[]    @relation("TemplateCreatedBy")
  posts                     Post[]
  serviceRequestComments    ServiceRequestComment[]
  sessions                  Session[]
  settingChangeDiffs        SettingChangeDiff[]
  taskTemplates             TaskTemplate[]
  teamMembers               TeamMember[]            @relation("UserTeamMember")
  tenantMemberships         TenantMembership[]
  grantedPermissions        UserPermission[]        @relation("GrantedBy")
  userPermissions           UserPermission[]        @relation("UserPermissions")
  userProfile               UserProfile?
  manager                   User?                   @relation("ManagerEmployee", fields: [managerId], references: [id])
  employees                 User[]                  @relation("ManagerEmployee")
  tenant                    Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflowsAsUser           UserWorkflow[]          @relation("WorkflowUser")
  workflowsTriggered        UserWorkflow[]          @relation("WorkflowTriggeredBy")
  workflowsApproved         UserWorkflow[]          @relation("WorkflowApprovedBy")
  workflowStepsApproved     WorkflowStep[]          @relation("WorkflowStepApprovedBy")
  workflowTemplatesCreated  WorkflowTemplate[]      @relation("WorkflowTemplateCreatedBy")
  workflowHistoryChanges    WorkflowHistory[]       @relation("WorkflowHistoryChangedBy")
  bulkOperationsCreated     BulkOperation[]         @relation("BulkOperationCreatedBy")
  bulkOperationsApproved    BulkOperation[]         @relation("BulkOperationApprovedBy")
  bulkOperationResults      BulkOperationResult[]
  bulkOperationHistoryChanges BulkOperationHistory[] @relation("BulkOperationHistoryChangedBy")
  filterPresetsCreated      FilterPreset[]          @relation("FilterPresetCreatedBy")

  @@unique([tenantId, email])
  @@index([tenantId, role])
  @@index([tenantId, createdAt])
  @@map("users")
}

model FilterPreset {
  id                String                @id @default(cuid())
  tenantId          String
  name              String                @db.VarChar(255)
  description       String?
  entityType        String                @db.VarChar(50) // 'users', 'clients', 'team_members', etc
  filterConfig      Json                  // Complex filter configuration
  filterLogic       String                @default("AND") // AND or OR for combining conditions
  isPublic          Boolean               @default(false) // Shared with team
  isDefault         Boolean               @default(false) // Applied by default
  icon              String?               @db.VarChar(50)
  color             String?               @db.VarChar(50)
  usageCount        Int                   @default(0)
  lastUsedAt        DateTime?
  createdBy         String
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  // Relations
  tenant            Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator           User                  @relation("FilterPresetCreatedBy", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, entityType])
  @@index([tenantId, isPublic])
  @@index([createdBy, createdAt])
  @@index([isDefault])
  @@map("filter_presets")
}
